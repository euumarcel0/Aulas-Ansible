---
- name: Copiar site local e hospedar em Docker com Apache2
  hosts: Linux
  become: yes
  tasks:
    - name: Criar o diretório temporário para o site
      file:
        path: /tmp/sitebike
        state: directory

    - name: Iniciar serviço Docker
      service:
        name: docker
        state: started
        enabled: yes

    - name: Clonar repositório do site
      git:
        repo: https://github.com/FofuxoSibov/sitebike.git
        dest: /tmp/sitebike

    - name: Criar o Dockerfile no diretório temporário
      copy:
        content: |
          FROM httpd
          COPY  . /usr/local/apache2/htdocs/
          EXPOSE 80
        dest: /tmp/sitebike/Dockerfile

    - name: Construir a imagem docker
      command: docker build -t meu-apache2-image /tmp/sitebike
      args:
        chdir: /tmp/sitebike/

    - name: Executar o contêiner Docker
      docker_container:
        name: meu-apache2-container
        image: meu-apache2-image
        state: started
        restart_policy: always
        ports:
          - "80:80"
